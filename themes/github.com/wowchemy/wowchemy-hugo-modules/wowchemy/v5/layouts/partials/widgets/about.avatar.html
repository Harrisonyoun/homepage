{{ $ := .root }}
{{ $page := .page }}
{{ $author := "" }}
{{ if .author }}
  {{ $author = .author }}
{{ else }}
  {{ $author = $page.Params.author }}
{{ end }}

{{ $person_page_path := (printf "/authors/%s" $author) }}
{{ $person_page := site.GetPage $person_page_path }}
{{ if not $person_page }}
  {{ errorf "Could not find an author page at `%s`. Please check the value of `author` in your About widget and create an associated author page if one does not already exist. See https://wowchemy.com/docs/page-builder/#about " $person_page_path }}
{{ end }}

{{ $avatar := ($person_page.Resources.ByType "image").GetMatch "*avatar*" }}
{{ $avatar_shape := site.Params.features.avatar.shape | default "circle" }}

<div class="container hero-section" style="display: flex; align-items: center; justify-content: center; flex-direction: column; margin-top: 50px; text-align: center;">
  
  {{/* Avatar Image in the Middle */}}
  {{ if $avatar }}
  <div class="avatar-section" style="margin-bottom: 20px;">
    {{ $avatar_image := $avatar.Fill "320x400 Center" }}
    <img class="avatar {{if eq $avatar_shape "square"}}avatar-square{{else}}avatar-circle{{end}}" src="{{ $avatar_image.RelPermalink }}" alt="{{ $person_page.Title }}" style="display: block; margin: 0 auto; max-width: 100%; height: auto; width: 320px;">
  </div>
  {{ end }}

  {{/* Introduction Text Below the Avatar */}}
  <div class="intro-section" style="max-width: 800px; padding: 0 20px;">
    {{ with $page.Title }}
      <h1 class="hero-title" style="font-weight: bold; margin-bottom: 15px;">{{ . | markdownify }}</h1>
    {{ else }}
      <h1 class="hero-title" style="font-weight: bold; margin-bottom: 15px;">Default Title: Please update the page title.</h1>
    {{ end }}

    {{ with $page.Content }}
      <div class="hero-lead" style="margin-bottom: 20px;">{{ . | markdownify }}</div>
    {{ else }}
      <div class="hero-lead" style="margin-bottom: 20px;">Default content: Please update the page content.</div>
    {{ end }}

    {{/* Call-to-action link */}}
    {{ if $page.Params.cta.url }}
      {{ $link := $page.Params.cta.url }}
      {{ $scheme := (urls.Parse $link).Scheme }}
      {{ $target := "" }}
      {{ if not $scheme }}
        {{ $link = $link | relLangURL }}
      {{ else if in (slice "http" "https") $scheme }}
        {{ $target = "target=\"_blank\" rel=\"noopener\"" }}
      {{ end }}
      <a href="{{ $link | safeURL }}" {{ $target | safeHTMLAttr }} class="btn btn-primary" style="background-color: #8b0000; color: #ffffff; padding: 10px 20px; text-decoration: none;">{{ $page.Params.cta.label | markdownify | emojify | safeHTML }}</a>
    {{ end }}

    {{/* Alternative Call-to-action link */}}
    {{ if $page.Params.cta_alt.url }}
      {{ $link := $page.Params.cta_alt.url }}
      {{ $scheme := (urls.Parse $link).Scheme }}
      {{ $target := "" }}
      {{ if not $scheme }}
        {{ $link = $link | relLangURL }}
      {{ else if in (slice "http" "https") $scheme }}
        {{ $target = "target=\"_blank\" rel=\"noopener\"" }}
      {{ end }}
      <a href="{{ $link | safeURL }}" {{ $target | safeHTMLAttr }} class="hero-cta-alt btn-lg" style="margin-left: 10px; text-decoration: none;">{{ $page.Params.cta_alt.label | markdownify | emojify | safeHTML }} <i class="fas fa-angle-right"></i></a>
    {{ end }}

    {{/* Call-to-action note */}}
    {{ with $page.Params.cta_note }}
    <p class="hero-note text-muted" style="margin-top: 10px;">{{ .label | markdownify | emojify | safeHTML }}</p>
    {{ end }}
  </div>

</div>
